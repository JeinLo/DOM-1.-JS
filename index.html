<!DOCTYPE html>
<html>

<head>
  <title>Проект "Комменты"</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <ul class="comments"></ul>
    <div class="add-form">
      <input type="text" class="add-form-name" placeholder="Введите ваше имя" />
      <textarea type="textarea" class="add-form-text" placeholder="Введите ваш комментарий" rows="4"></textarea>
      <div class="add-form-row">
        <button class="add-form-button">Написать</button>
      </div>
    </div>
  </div>
</body>

<script>
document.addEventListener('DOMContentLoaded', function() {
  let commentsArray = [
    {
      id: 1,
      author: 'Глеб Фокин',
      date: '12.02.22 12:18',
      text: 'Это будет первый комментарий на этой странице',
      likes: 3,
      liked: false
    },
    {
      id: 2,
      author: 'Варвара Н.',
      date: '13.02.22 19:22',
      text: 'Мне нравится как оформлена эта страница! ❤',
      likes: 75,
      liked: true
    }
  ];

  const commentsList = document.querySelector('.comments');
  const addButton = document.querySelector('.add-form-button');
  const nameInput = document.querySelector('.add-form-name');
  const commentInput = document.querySelector('.add-form-text');

  function renderComments() {
    commentsList.innerHTML = '';
    commentsArray.forEach(comment => {
      const commentItem = document.createElement('li');
      commentItem.classList.add('comment');

      const commentHeader = document.createElement('div');
      commentHeader.classList.add('comment-header');

      const nameDiv = document.createElement('div');
      nameDiv.textContent = comment.author;

      const dateDiv = document.createElement('div');
      dateDiv.textContent = comment.date;

      commentHeader.appendChild(nameDiv);
      commentHeader.appendChild(dateDiv);

      const commentBody = document.createElement('div');
      commentBody.classList.add('comment-body');

      const commentText = document.createElement('div');
      commentText.classList.add('comment-text');
      commentText.textContent = comment.text;

      commentBody.appendChild(commentText);

      const commentFooter = document.createElement('div');
      commentFooter.classList.add('comment-footer');

      const likesDiv = document.createElement('div');
      likesDiv.classList.add('likes');

      const likesCounter = document.createElement('span');
      likesCounter.classList.add('likes-counter');
      likesCounter.textContent = comment.likes;

      const likeButton = document.createElement('button');
      likeButton.classList.add('like-button');
      if (comment.liked) {
        likeButton.classList.add('-active-like');
      }
      likeButton.dataset.commentId = comment.id; // Добавляем идентификатор комментария в dataset

      likesDiv.appendChild(likesCounter);
      likesDiv.appendChild(likeButton);

      commentFooter.appendChild(likesDiv);

      commentItem.appendChild(commentHeader);
      commentItem.appendChild(commentBody);
      commentItem.appendChild(commentFooter);

      commentsList.appendChild(commentItem);
    });
  }

  renderComments();

  function validateInputs() {
    const name = nameInput.value.trim();
    const comment = commentInput.value.trim();

    addButton.disabled = name === '' || comment === '';
    addButton.style.backgroundColor = addButton.disabled ? '#ccc' : '#bcec30';
  }

  nameInput.addEventListener('input', validateInputs);
  commentInput.addEventListener('input', validateInputs);

  addButton.addEventListener('click', function() {
    const name = nameInput.value.trim();
    const comment = commentInput.value.trim();

    if (name === '' || comment === '') {
      alert('Пожалуйста, заполните все поля');
      return;
    }

    const currentDate = new Date().toLocaleString();

    // Генерируем уникальный идентификатор для нового комментария
    const newCommentId = commentsArray.length + 1;

    commentsArray.push({
      id: newCommentId,
      author: name,
      date: currentDate,
      text: comment,
      likes: 0,
      liked: false
    });

    renderComments();

    nameInput.value = '';
    commentInput.value = '';
    validateInputs();
  });

  document.addEventListener('click', function(event) {
    if (event.target && event.target.classList.contains('like-button')) {
      const commentId = parseInt(event.target.dataset.commentId); // Получаем идентификатор комментария из dataset
      const commentIndex = commentsArray.findIndex(comment => comment.id === commentId); // Находим индекс комментария в массиве по его идентификатору

      if (commentIndex !== -1) {
        const likeButton = event.target;
        const likesCounter = likeButton.parentNode.querySelector('.likes-counter');

        if (!commentsArray[commentIndex].liked) {
          commentsArray[commentIndex].likes++;
          commentsArray[commentIndex].liked = true;
          likesCounter.textContent = commentsArray[commentIndex].likes;
          likeButton.classList.add('-active-like');
        } else {
          commentsArray[commentIndex].likes--;
          commentsArray[commentIndex].liked = false;
          likesCounter.textContent = commentsArray[commentIndex].likes;
          likeButton.classList.remove('-active-like');
        }
      }
    }
  });
});
</script>

</html>