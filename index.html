<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul id="list" class="comments">
      </ul>
      <div id="form" class="add-form">
        <input
          id="nameInput"
          type="text"
          class="add-form-name"
          placeholder="Введите ваше имя"
        />
        <textarea
          id="commentInput"
          type="textarea"
          class="add-form-text"
          placeholder="Введите ваш коментарий"
          rows="4"
        ></textarea>
        <div class="add-form-row">
          <button disabled id="writeButton"  class="add-form-button">Написать</button>
        </div>
      </div>
    </div>

    
  </body>

  <script>
"use strict";
function MinSec() {
    let currentDate = new Date();
    let options = {hour: '2-digit', minute:'2-digit'};
    return (currentDate.toLocaleTimeString('ru-RU', options)); 
}

function Year() {
    const months = [1, 2, 3, 4, 5, 6,
        7, 8, 9, 10, 11, 12];
        let myDate = new Date();
        
        let fullDate =  myDate.getDate() +
        "." + months[myDate.getMonth()] +
        "." + myDate.getFullYear() ;
        
        return (fullDate);
        MinSec()

}
    const nameInputEl = document.getElementById('nameInput');
    const listEL = document.getElementById('list');
    const commentInputEl = document.getElementById('commentInput');
    const writeButtonEl = document.getElementById('writeButton');
      
    const peoples = [{
      name: 'Глеб Фокин',
      comment:'Это будет первый комментарий на этой странице',
      time:'12.02.22 12:18',
      like: 3,
      isLike: false
    },{
      name: 'Варвара Н.',
      comment:'Мне нравится как оформлена эта страница! ❤',
      time:'13.02.22 19:22',
      like: 75,
      isLike: true
    }]

const initEventlist = () => {     
const commentEl = document.querySelectorAll('.comment');
for (const commentEls of commentEl) {
    commentEls.addEventListener('click', () => {
    })
}
}

const initDeleteButton = () => {
  const deleteButtonEls = document.querySelectorAll('.deleteButton');
  for (const deleteButtonEl of deleteButtonEls) {
    deleteButtonEl.addEventListener('click', () => {
     const index = deleteButtonEl.dataset.index;
     peoples.splice(index, 1);
    render();
    });
  }
}

const initlikeButton = () => {
  const likeButtonEls = document.querySelectorAll('.like-button');
  for (const likeButtonEl of likeButtonEls) {
    likeButtonEl.addEventListener('click', () => {
     const index = likeButtonEl.dataset.index;
     
     if (peoples[index].isLike === false || peoples[index].like === 0) {  
     peoples[index].like = parseInt(peoples[index].like) + 1; 
     peoples[index].isLike = true;
     } else {
      peoples[index].like = parseInt(peoples[index].like) - 1;
    peoples[index].isLike = false;
     }

    render();
    });
  }
}

const commetForm = () => {
  const commentBodyElements = document.querySelectorAll('.comment-body');
  for (const commentBodyElement of commentBodyElements) {
    commentBodyElement.addEventListener('click', () => {
      const index = commentBodyElement.dataset.index;
      commentInputEl.value = `${peoples[index].comment} ${peoples[index].name}`;
      render();
    });
  }
}
commetForm();
const render = () => {
 const peopleHtml = peoples.map((people, index) => {
    return `<li data-name="${people.name}" id="com" class="comment">
          <div class="comment-header">
            <div >${people.name}</div>
            <div> ${people.time}</div>
          </div>
          <div class="comment-body" data-index="${index}">
            <div class="comment-text">
             ${people.comment}
            </div>
          </div>   
          <div class="comment-footer">
            <button class="deleteButton" data-index="${index}"">Удалить</button>
            <div class="likes">
              <span class="likes-counter" data-index="${index}" >${people.like}</span>
              <button class="like-button ${people.isLike === true ? "-active-like" : "" }"
               data-index="${index}"></button>
            </div>
          </div>
        </li>`
  }).join('');
  listEL.innerHTML = peopleHtml;
  initEventlist();
  initDeleteButton();
  initlikeButton();
  commetForm();

}

render();


    nameInputEl.addEventListener('input', function(event) {
  writeButtonEl.disabled = (nameInputEl.value === '');
});

      writeButtonEl.addEventListener('click', () => {
        setTimeout(() => { nameInputEl.classList.remove('err');}, 1000 * 1);
        setTimeout(() => { commentInputEl.classList.remove('err');}, 1000 * 1);

            if (nameInputEl.value === '') {
              nameInputEl.classList.add("err");
              return;
            }
            if (commentInputEl.value === '') {
              commentInputEl.classList.add('err');
              return;
            }
             
            if (nameInputEl.value != '') {
                
        peoples.push({
              name:nameInputEl.value
              .replaceAll("<", "&lt;")
              .replaceAll(">", "&gt;"),
              time:Year(),
              comment:commentInputEl.value
              .replaceAll("<", "&lt;")
              .replaceAll(">", "&gt;"),
              like:0
             });

        render();
 

        this.disabled = true
        nameInputEl.value = (''); 
        commentInputEl.value = ('');
  
    }});

    console.log("It works!");
  </script>
</html>
